<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ECS521 Project: Escape Game</title>
<style>
body{
	background-color:black;
	margin: 0;
}
#game{
	display:block;
	width :1200px;
	margin-left: auto;
	margin-right: auto;
}
#canvasOne{
	margin:0;
}
#canvasTwo{
	background-color:white;
	margin:0;
}
</style>
</head>
<body>
<div id="game">
	<canvas id = "canvasTwo" width = "200" height = "700"></canvas
    ><canvas id = "canvasOne" width = "1000" height = "700"></canvas>
</div>
<script type="text/javascript" src="Events.js"></script>
<script type="text/javascript">
    /**
     * Screen 0: start screen
     * 1: basic living room view
     * 2: up close puzzle view
     * 3: up close portrait painting view
     * 4: up close desk drawer view
     * 5: up close xylophone view
     * 6: hallway view
     * 7: up close bedroom door
     * 8: winning screen
     * 9: death by monster screen
     * 10: death by timer screen
     */
    var currentScreen = 0;
    var timer = 0;
	var totalResources = 9;
	var numResourcesLoaded = 0;
	var finishedLoading = false;
	var images = {};
	var hasBedroomKey = false; // until they get it from the portrait
    var hasWeapon = false; // until they get the fire poker

	function loadImage(name) {
		images[name] = new Image();
		images[name].onload = function() {
			resourceLoaded();
		}
		images[name].src = "./images/" + name + ".png";
	}
	function resourceLoaded() {

		numResourcesLoaded += 1;
		if(numResourcesLoaded === totalResources) {
			finishedLoading = true;
		}
	}
    function init(events) {
        var canvas = events.getCanvas();
        var context = events.getContext();
		
		context.fillStyle="white";
		context.font = "100px Georgia";
		context.fillText("loading...", 40, 140);
		
		loadImage("SCREEN1");
		loadImage("SCREENGAMEOVER");
		loadImage("SCREENMONSTER");
		loadImage("SCREENWIN");
		loadImage("opendoor");
		loadImage("monster");
		loadImage("livingroom");
		loadImage("hallway");
		loadImage("closeddoor");
		
		var checkloaded = setInterval(function(){
			if(finishedLoading){
				clearInterval(checkloaded);
				continueGame(events);
			}
		},1);
    }
    function changeScreen(screen,events){
		var clone = events.canvas.cloneNode();
		while (events.canvas.firstChild) {
		  clone.appendChild(events.canvas.lastChild);
		}
		events.canvas.parentNode.replaceChild(clone, events.canvas);
		currentScreen = screen;
		console.log("to screen: " + screen);
		continueGame(events);	
	}
	function createEventBox(x,y,width,height,screen,events){
		events.beginRegion();
		events.context.beginPath();
		events.context.rect(x, y, width, height);
		events.context.lineWidth = 4;
		events.context.strokeStyle = "black";
		events.context.fillStyle = "#00D2FF";
		events.context.fill();
		events.context.stroke();
		events.context.closePath();
		events.addRegionEventListener("mousedown",function(){
			changeScreen(screen,events);
		});
		events.closeRegion();
	}
	
	
	function continueGame(events) {

		events = new Events("canvasOne");
	
        if (currentScreen == 0) {
			events.setStage(function () {
				this.clear();
				events.context.drawImage(images["SCREEN1"], 0, 0, events.canvas.width, events.canvas.height);
				createEventBox(270,430,460,222,1,events);	
			});
        } 
		else if (currentScreen == 1) {
		
			events.setStage(function () {
				this.clear();
				events.context.drawImage(images["livingroom"], 0, 0, events.canvas.width, events.canvas.height);
				createEventBox(0,0,100,50,0,events);
				createEventBox(880,0,120,250,6,events);
			});

        }
		else if (currentScreen == 6) {
		
			events.setStage(function () {
				this.clear();
				events.context.drawImage(images["hallway"], 0, 0, events.canvas.width, events.canvas.height);
				createEventBox(0,0,100,50,0,events);
				createEventBox(0,450,430,250,1,events);	
				createEventBox(800,0,200,300,7,events);	
			});

        }
		else if (currentScreen == 7) {
		
			events.setStage(function () {
				this.clear();
				events.context.drawImage(images["closeddoor"], 0, 0, events.canvas.width, events.canvas.height);
				createEventBox(0,0,100,50,0,events);
				createEventBox(0,450,430,250,6,events);	
			});

        }
    }
	

    // if they click on the bedroom door AFTER they are at the close up view (not if they are just inside the hallway still)
    function attemptUnlockUpCloseBedroomDoor(canvas,context) {
        if (hasBedroomKey && hasWeapon) {
                context.drawImage(images["opendoor"], 0, 0, canvas.width, canvas.height);

            // then play the video of beating the monster and getting the key
        } else if (hasBedroomKey && ! hasWeapon) {
            context.drawImage(images["monster"], 0, 0, canvas.width, canvas.height);

            // then play the video of getting killed by the monster

            // then take user to end screen
			context.drawImage(images["SCREENMONSTER"], 0, 0, canvas.width, canvas.height);
            

        } else {
            // play some kind of "locked door" sound, display text of "door is locked"
        }
    }


    window.onload = function() {
		var events = new Events("canvasOne");
		
		init(events);
		
		
	}
</script>

</body>
</html>
