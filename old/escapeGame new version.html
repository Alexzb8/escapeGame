<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ECS521 Project: Escape Game</title>
<style>
body{
	background-color:black;
	margin: 0;
}
#game{
	display:block;
	width :1000px;
	margin-left: auto;
	margin-right: auto;
}
#canvasOne{
	margin:0;
}
#canvasTwo{
	background-color:white;
	margin:0;
}
</style>
</head>
<body>
<div id="game">
    <canvas id = "canvasOne" width = "1000" height = "700"></canvas>
</div>

<script type="text/javascript" src="Events.js"></script>
<script type="text/javascript" src ="Animation.js"></script>
<script type="text/javascript" src ="audio.js"></script>
<script type="text/javascript">

    /**
     * Screen 0: start screen
     * 1: basic living room view
     * 2: up close puzzle view
     * 3: up close portrait painting view
     * 4: up close desk drawer view
     * 5: up close xylophone view
     * 6: hallway view
     * 7: up close bedroom door
     * 8: winning screen
     * 9: death by monster screen
     * 10: death by timer screen
	   11: LAMP TOGGLE
     */
	var debug = false;
    var currentScreen = 1;
    var timer = 0;
	var totalResources = 48;
	var numResourcesLoaded = 0;
	var finishedLoading = false;
	var images = {};
	var hasBedroomKey = true; // until they get it from the portrait
    var hasWeapon = false; // until they get the fire poker
    var hasStick = false; // until they get the stick from the lampshade
	var portraitOpen = false;
	var portraitOpening = false;//check if portrait is opening
	var drawerOpen = false;
	var drawerOpening = false;//check if drawer is opening
	var bedroomOpen = false;
	var bedroomOpening = false;//check if bedroom is opening
	var bedroomOpening2 = false;//check if bedroom opening animation is at its second stage
	var monsterAlive = true;
	var hasDrawerKey = true;
	var safeOpen = false; //check if safe is open
	var lampOn = true;
	var puzzleComplete = false;
	var puzx = [488, 541, 337, 337, 250, 445, 225, 393, 193];
	var puzy = [495, 401, 306, 402, 255, 409, 443, 495, 345];
	var puzzleLocation = "";
	var solvedXylo = false;
	var cursorX = -500;
    var cursorY = 0;
	var currentnote = null;
	var fireCount = 1;
	//define global loop for later use
	var intervalLoop;
	//global events
	var events;
	//array to hold the different screens
	var screens = [];
	//array to draw events for different screens
	var drawEvents = [];
	//time for animations
	var d = Date.now();
	//messages
	var message = new Message;
	var toolbox = false; //condition to draw toolbox
	//bing sound
	var bing = AudioFX('audio/BLING',   { formats: ['wav'], pool: 100 });
	//death sound
	var death = AudioFX('audio/death',   { formats: ['wav'], pool: 100 });
	//monster death sound
	var monsterdeath = AudioFX('audio/monsterdeath',   { formats: ['wav'], pool: 100 });
	
	

    // xylophone notes
    var noteRow = [];
	
	//create xylophone puzzle notes
	var noteLetters = ["C","D","E","F","G","A","B"];
	var xylophoneAnswer = [];
	var numNotes = 6;            //number of notes user has to input
	var inputNotes = [numNotes];
	var noteString = "";	
	for(i = 0 ; i<numNotes;i++){
		xylophoneAnswer[i] = random(0,6);
		
		if(i==0){
			noteString = noteString +  noteLetters[xylophoneAnswer[i]];
		}
		else{
			noteString = noteString +", " +  noteLetters[xylophoneAnswer[i]];
		}
	}
	console.log(noteString);
	
	//portrait code
	var portraitCode = [4];
	var portraitInput = [0,0,0,0];
	
	for(i=0;i<4;i++){	
		portraitCode[i] = random(0,9);		
	}
	console.log(portraitCode);

	
	// Returns a random integer between min (included) and max (included)
	function random(min, max) {
	  min = Math.ceil(min);
	  max = Math.floor(max);
	  return Math.floor(Math.random() * (max - min + 1)) + min;
	}
	function newNote(note){
		//input new note into array and check if all notes are equal
		
		var equal = 0;
		var i = 0;
	
		for(i=0;i<numNotes-1;i++){
			inputNotes[i] = inputNotes[i+1];
			if(inputNotes[i]==xylophoneAnswer[i]){equal++;}
		}
		
		inputNotes[i] = note;
		if(inputNotes[i]==xylophoneAnswer[i]){
			
			equal++;
			if(equal==6){
				//puzzle is solved			
				solvedXylo = true;
				message.displayMess("You pressed the right keys Xp");
				changeScreen(1);
				
			}
			
		}
		
		
	
	}
	function newInputPortrait(up,num){
		//change array of input of portrait
				
		if(up){
			if(portraitInput[num]<9){
				portraitInput[num]++;
			}
			else{
				portraitInput[num]=0;
			}
		}
		else{
			if(portraitInput[num]>0){
				portraitInput[num]--;
			}
			else{
				portraitInput[num]=9;
			}
		}
		
		
		
		
	
	}
	function changeScreen(screen){
		//verify change of screen was handled correctly according to lamp state
		if(screen==11 && currentScreen==1){
			screen = 1;
			lampOn = !lampOn;
		}
		currentScreen = screen;
		
	}
	function loadImage(name) {
		//add image to images array and check if loaded
		images[name] = new Image();
		images[name].onload = function() {
			resourceLoaded();
		}
		images[name].src = "./images/" + name + ".png";
	}
	function resourceLoaded() {
		//check if all images are loaded
		numResourcesLoaded += 1;
		if(numResourcesLoaded === totalResources) {
			game();
		}
	}
    function init() {
        var canvas = document.getElementById('canvasOne');
        var context = canvas.getContext('2d');

		//loading prompt for user
		context.fillStyle="white";
		context.font = "100px Georgia";
		context.fillText("loading...", 40, 140);

		//load images
		loadImage("SCREEN1");
		loadImage("SCREENGAMEOVER");
		loadImage("SCREENMONSTER");
		loadImage("SCREENWIN");
		loadImage("opendoor");
		loadImage("monster");
		loadImage("livingroom");
		loadImage("hallway");
		loadImage("closeddoor");
		loadImage("fire1");
		loadImage("fire2");
		loadImage("fire3");
		loadImage("fire3dark");
		loadImage("fire2dark");
		loadImage("fire1dark");
		loadImage("xylophone");
		loadImage("table");
		loadImage("puzzleboxwpieces");
		loadImage("puzzleboxwpiecesdark");
		loadImage("puzzleboxwpiecescomplete");
		loadImage("puzzleboxwpiecescompletedark");
		loadImage("puzzleopened");
		loadImage("halfopened");
		loadImage("openedsafe");
		loadImage("openportrait");
		loadImage("portraitclose");
		loadImage("key2");
		loadImage("poker");
		loadImage("drawerclosed");
		loadImage("drawerhalfopened");
		loadImage("draweropened");
		loadImage("deathdoorangled");
		loadImage("deathdoorangled2");
		loadImage("deathdoorangled2withmonster");
		loadImage("monster");
		loadImage("opendoor");	
		loadImage("SCREENMONSTER");
		loadImage("lamplightingafter");
        loadImage("lampwithoutstick");
		
		//load puzzlepieces
		for(i=0;i<9;i++){
			loadImage(i);
		}
        

		

        // fill in each note of the close-up xylophone
        noteRow[0] = new Note(0,"cNote", 17, 334, 175,
            688, context);
        noteRow[1] = new Note(1,"dNote", 184, 359, 332,
            683, context);
        noteRow[2] = new Note(2,"eNote", 336, 371, 472,
            673, context);
        noteRow[3] = new Note(3,"fNote", 473, 381, 607,
            673, context);
        noteRow[4] = new Note(4,"gNote", 615, 390, 742,
            673, context);
        noteRow[5] = new Note(5,"aNote", 746, 397, 868,
            665, context);
        noteRow[6] = new Note(6,"bNote", 873, 405, 989,
            665, context);
			
		

    }
	function createEventBox(x,y,width,height,screen){		
		createEventShape(
		x,
		y,
		x+width,
		y,
		x+width,
		y+height,
		x,
		y+height,
		screen);		
	}
	function createEventShape(x,y,x1,y1,x2,y2,x3,y3,screen){
			
			events.beginRegion();
			events.context.beginPath();
			//events.context.fillStyle = "#00D2FF";
			events.context.moveTo(x,y);
			events.context.lineTo(x1,y1);
			events.context.lineTo(x2,y2);
			events.context.lineTo(x3,y3);
			//events.context.fill();
			events.context.closePath();	
			events.addRegionEventListener("mousedown",function(){				
				changeScreen(screen);
			});
			events.addRegionEventListener("mousemove", function () {
					document.body.style.cursor = "pointer";
			});
			
			events.closeRegion();
		
	}
	function getItemEvent(x,y,width,height,item){
			
			events.beginRegion();
			events.context.beginPath();
			//events.context.fillStyle = "#00D2FF";
			events.context.rect(x,y,width,height);
			//events.context.fill();
			events.context.closePath();	
			events.addRegionEventListener("mousedown",function(){
				if(item=="bedroomkey"){
					hasBedroomKey = true;
					message.displayMess("You found the bedroom key");
					
				}
				else if(item=="poker"){
					hasWeapon = true;
					message.displayMess("You found a weapon!");
					
				}
				else if(item=="openportrait"){
					portraitOpen = !portraitOpen;
					portraitOpening = true;
					setTimeout(function(){ portraitOpening = false; }, 500);
					safeOpen = false;
				}
				else if(item=="opendrawer"){
					drawerOpening = true;
					drawerOpen = !drawerOpen;
					setTimeout(function(){ drawerOpening = false; }, 500);
				}
				else if(item=="toggledoor"){
				
					if(hasBedroomKey){
						
						//animate bedroom door
						if(bedroomOpen){
							//animate bedroom closing
							bedroomOpening2 = true;							
							
							setTimeout(function(){
								bedroomOpening = true; 
								bedroomOpening2 = false;					
								
								setTimeout(function(){
									bedroomOpening = false;
									bedroomOpen = false;
								}, 500);								
							}, 500);
						}
						else{
							//animate bedroom opening							
							message.displayMess("You used the bedroom key");
							bedroomOpening = true;
							bedroomOpen = !bedroomOpen;
							
							
							setTimeout(function(){
								bedroomOpening = false; 
								bedroomOpening2 = true;					
								
								setTimeout(function(){
									bedroomOpening2 = false;
									bedroomOpen = true;
									
									if(monsterAlive){
										if(hasWeapon){
											message.displayMess("Used weapon on monster");
											//play monster dying sound
											monsterdeath.play();
											//kill monster
											setTimeout(function(){
												monsterAlive = false;												
											}, 1500);	
											
										}
										else{
											//play dying sound
											death.play();
											//change screen
											setTimeout(function(){
												changeScreen(9);												
											}, 1500);											
										}
									}
									
								}, 500);								
							}, 500);
						
						}
					}
					else{
						message.displayMess("You dont have the key");
					}
					
					
					
				}
				else if(item=="enter"){
					//check if code is correct
					var equal = 0;
					for(i=0;i<4;i++){
					
						if(portraitInput[i]==portraitCode[i]){
							equal++;
						}
					
					}
					
					if(equal==4){
						//pasword correct	
						bing.play();
						safeOpen = true;
						message.displayMess("Password is correct");
						
					}
					else{
						//play error sound
						bing.play();
					}
				
				}
				else if(item=="0up"){
					newInputPortrait(true,0);
				}
				else if(item=="1up"){
					newInputPortrait(true,1);
				}
				else if(item=="2up"){
					newInputPortrait(true,2);
				}
				else if(item=="3up"){
					newInputPortrait(true,3);
				}
				else if(item=="0down"){
					newInputPortrait(false,0);
				}
				else if(item=="1down"){
					newInputPortrait(false,1);
				}
				else if(item=="2down"){
					newInputPortrait(false,2);
				}
				else if(item=="3down"){
					newInputPortrait(false,3);
				}
				
				
			});
			events.addRegionEventListener("mousemove", function () {
					document.body.style.cursor = "pointer";
			});
			
			events.closeRegion();
		
	}
	function drawSafe(){
		
		var x = 570;
		var y = 320;
		for(i=0;i<4;i++){
			//draw triangles
			events.context.beginPath();
			events.context.lineWidth = 4;
			events.context.strokeStyle = "black";
			events.context.fillStyle = "#FFFB00";
			events.context.moveTo(x+25,y-145);
			events.context.lineTo(x+50,y-95);
			events.context.lineTo(x,y-95);
			events.context.closePath();
			events.context.fill();
			events.context.stroke();
			
			events.context.beginPath();
			events.context.lineWidth = 4;
			events.context.strokeStyle = "black";
			events.context.fillStyle = "#FFFB00";
			events.context.moveTo(x,y+55);
			events.context.lineTo(x+50,y+55);
			events.context.lineTo(x+25,y+105);
			events.context.closePath();	
			events.context.fill();
			events.context.stroke();
		
			//draw number
			events.context.save();
			events.context.font = '60pt Georgia';
			events.context.fillStyle= "black";
			events.context.fillText(portraitInput[i], x, y);				
			events.context.restore();
			x = x + 101;
		}
	
	}
	function checkregion(mouse){

	}
	function drawStick(cursorX,cursorY) {
			
		events.context.beginPath();
		events.context.arc(cursorX, cursorY, 30, 0, 2 * Math.PI, true);
		events.context.fillStyle = "#FF6A6A";
		events.context.strokeStyle = "#FF6A6A";
		events.context.lineWidth = 7;
		events.context.closePath();
		events.context.fill();

		events.context.beginPath();
		events.context.moveTo(cursorX + 15, cursorY + 15);
		events.context.lineTo(cursorX + 130, cursorY + 130);
		events.context.stroke();
		events.context.closePath();
	}
    // defining each note on the xylophone
    function Note(num, note, topLeftX, topLeftY, topRightX, bottomLeftY, context) {
        this.ctx = context;

        this.note = note;
		this.noteNum = num;
		this.noteAudio = AudioFX('audio/'+note,   { formats: ['wav'], pool: 100 });
		this.alpha = 0.0;

        //x and y coordinates of the outline of the key
        this.topLeftX = topLeftX;
        this.topLeftY = topLeftY;
        this.topRightX = topRightX;
        this.bottomLeftY = bottomLeftY;
		
        this.width = topRightX - topLeftX;
        this.height = bottomLeftY - topLeftY;
		this.drawBox = function(){
			
			this.alpha = this.alpha - .01;
			if(this.alpha>0){
				ctx = events.context;
				ctx.save();
				ctx.beginPath();
				ctx.rect(this.topLeftX, this.topLeftY, this.width, this.height);
				ctx.fillStyle = "rgba(255, 0, 0, " + this.alpha + ")";
				ctx.fill();
				ctx.closePath();				
				ctx.restore();
			}
			else{
				this.alpha = 0.0;
			}
		};
    }
    Note.prototype.playSelf = function() {
		this.alpha = 1.0;
		this.noteAudio.play();
		//update and check note input array
      	newNote(this.noteNum);        
    };
    Note.prototype.keyDidPlay = function(stickX, stickY) {
        if (stickX >= this.topLeftX && stickX <= this.topRightX
            && stickY >= this.topLeftY && stickY <= this.bottomLeftY) {
            return true;
        } else {
            return false;
        }
    };
	function Message(){
		this.text= "";
		this.alpha = 0.0;
		this.displayMess = function(string){
			this.text = string;
			this.alpha = 1.0
		};
		this.drawMessage = function(){
			
			if(this.alpha>0){
				//draw message
				events.context.save();
				events.context.font = '60pt Georgia';
				events.context.lineWidth = 3;
				events.context.strokeStyle = "rgba(0, 0, 0, " + this.alpha + ")";
				events.context.fillStyle= "rgba(255, 255, 255, " + this.alpha + ")";
				events.context.fillText(this.text, 0, 680);
				events.context.strokeText(this.text, 0, 680);				
				events.context.restore();
			
				this.alpha = this.alpha - 0.01;
			}
			
		
		};
	
	}
	    // if they click on the bedroom door AFTER they are at the close up view (not if they are just inside the hallway still)
    function attemptUnlockUpCloseBedroomDoor(canvas,context) {
        if (hasBedroomKey && hasWeapon) {
                context.drawImage(images["opendoor"], 0, 0, canvas.width, canvas.height);

            // then play the video of beating the monster and getting the key
        } else if (hasBedroomKey && ! hasWeapon) {
            context.drawImage(images["monster"], 0, 0, canvas.width, canvas.height);

            // then play the video of getting killed by the monster

            // then take user to end screen
			context.drawImage(images["SCREENMONSTER"], 0, 0, canvas.width, canvas.height);


        } else {
            // play some kind of "locked door" sound, display text of "door is locked"
        }
    }
	function createScreens(){
		//for puzzle
		var draggingRect = [false,false,false,false,false,false,false,false,false];
		var check = 0;
		var draggingRectOffsetX = [0,0,0,0,0,0,0,0,0];
		var draggingRectOffsetY = [0,0,0,0,0,0,0,0,0];
		var piecewidth = 69;
		var context = events.context;
		var pixlet = 10;//how many pixels we can be not correctly placed	
		//xylophone stick coordinates
		var stickX = -500;
		var stickY = 0;
		
		screens = [
			//main menu draw
			function(){
				events.context.drawImage(images["SCREEN1"], 0, 0, events.canvas.width, events.canvas.height);
			},
			//living room draw
			function(){
				time = Date.now();
				var firestring ;
				
				if(lampOn){
					firestring = "fire"+fireCount;
					events.context.drawImage(images["livingroom"], 0, 0, events.canvas.width, events.canvas.height);
					if(puzzleComplete){
						events.context.drawImage(images["puzzleboxwpiecescomplete"], 440, 370, 120, 120);
					}
					else{
						events.context.drawImage(images["puzzleboxwpieces"], 440, 370, 120, 120);
					}
				}
				else {
					firestring = "fire"+fireCount+"dark";
					if (hasStick) {
						events.context.drawImage(images["lampwithoutstick"], 0, 0, events.canvas.width, events.canvas.height);
					}
					else{
						events.context.drawImage(images["lamplightingafter"], 0, 0, events.canvas.width, events.canvas.height);
					}
					if(puzzleComplete){
						events.context.drawImage(images["puzzleboxwpiecescompletedark"], 440, 370, 120, 120);
					}
					else{
						events.context.drawImage(images["puzzleboxwpiecesdark"], 440, 370, 120, 120);
					}
				}
				
				
				if(!hasWeapon){
					events.context.drawImage(images["poker"], 317, 170, 120, 120);
				}
				
				//draw light switch?
				
				events.context.drawImage(images[firestring], 170, 170, 200, 200);
				if(time>d+100){
					fireCount++;
					d = Date.now();
				}
				if(fireCount==4){
					fireCount=1;
				}			
			},
			//puzzle draw
			function(){
				var i ;
				events.context.drawImage(images["table"], 0, 0, events.canvas.width, events.canvas.height);
				events.context.drawImage(images["puzzleopened"], 400, 90, 350, 350);
				for(i=0;i<9;i++){
					events.context.drawImage(images[i], puzx[i], puzy[i], piecewidth, piecewidth);
				}
			},
			//Portrait draw
			function(){
				if(portraitOpening){
					events.context.drawImage(images["halfopened"], 0, 0, events.canvas.width, events.canvas.height);
					drawSafe();
				}
				else if(safeOpen){
					events.context.drawImage(images["openedsafe"], 0, 0, events.canvas.width, events.canvas.height);
					if(!hasBedroomKey){
						events.context.drawImage(images["key2"], 650, 220, 200, 200);
					}
					
				}
				else if(portraitOpen){
					events.context.drawImage(images["openportrait"], 0, 0, events.canvas.width, events.canvas.height);
					drawSafe();
				}
				else{
					events.context.drawImage(images["portraitclose"], 0, 0, events.canvas.width, events.canvas.height);
				}
				
			},
			//Drawer draw
			function(){
				if (drawerOpening) {
						events.context.drawImage(images["drawerhalfopened"], 0, 0, events.canvas.width, events.canvas.height);
				} 
				else if(!drawerOpen){
					events.context.drawImage(images["drawerclosed"], 0, 0, events.canvas.width, events.canvas.height);
				}
				else {
						events.context.drawImage(images["draweropened"], 0, 0, events.canvas.width, events.canvas.height);
						events.context.font = "30px Arial";
						events.context.fillStyle = "#000000";
						events.context.fillText(noteString, 400, 550);
						
				}
			},
			//xylophone draw
			function(){
				events.context.drawImage(images["xylophone"], 0, 0, events.canvas.width, events.canvas.height);
				
				var i ;
				
				for(i=0;i<7;i++){
					noteRow[i].drawBox();
				}
				
				drawStick(stickX,stickY);
				
			},
			//hallway Draw
			function(){
				events.context.drawImage(images["hallway"], 0, 0, events.canvas.width, events.canvas.height);
			
			},
			//bedroom draw
			function(){
				if(bedroomOpening){
					events.context.drawImage(images["deathdoorangled"], 0, 0, events.canvas.width, events.canvas.height);
				}
				else if(bedroomOpening2){
					if(monsterAlive){
						events.context.drawImage(images["deathdoorangled2withmonster"], 0, 0, events.canvas.width, events.canvas.height);
					}
					else{
						events.context.drawImage(images["deathdoorangled2"], 0, 0, events.canvas.width, events.canvas.height);
					}
				}
				else{
					if(bedroomOpen){
						if(monsterAlive){
							events.context.drawImage(images["monster"], 0, 0, events.canvas.width, events.canvas.height);
						}
						else{
							events.context.drawImage(images["opendoor"], 0, 0, events.canvas.width, events.canvas.height);
						}
					}
					else{
						events.context.drawImage(images["closeddoor"], 0, 0, events.canvas.width, events.canvas.height);
					}
				
				}
				
			},
			function(){
			},
			//death by monster draw
			function(){			
				events.context.drawImage(images["SCREENMONSTER"], 0, 0, events.canvas.width, events.canvas.height);
			},
			function(){
			}
		];
		
		drawEvents = [
			//main menu events
			function(){
				createEventBox(270,430,460,222,1);
			},
			//living room events
			function(){
				createEventBox(500,32,67,75,3);
				createEventBox(510, 150, 130, 20, 4);
				createEventBox(0,0,100,50,0);
				createEventShape(880,0,1000,0,1000,360,880,260,6);
				if(!solvedXylo){
					createEventShape(7,520,229,385,265,416,77,590,5);
				}
				createEventShape(400,24,430,24,448,90,387,90,11);
				if(!puzzleComplete){
					createEventBox(400,380,220,120,2);
				}
				if(!hasWeapon){
					getItemEvent( 350, 170, 30, 120,"poker");
				}
			},
			//puzzle events
			function(){		
				createEventBox(0,0,100,50,1);
				
				
				//now manage the pieces
				for(i=0;i<9;i++){
					if (draggingRect[i]) {
						var mousePos = events.getMousePos();
						puzx[i] = mousePos.x - draggingRectOffsetX[i];
						puzy[i] = mousePos.y - draggingRectOffsetY[i];					
					}
					
					events.beginRegion();
					events.context.rect(puzx[i], puzy[i], piecewidth,piecewidth);
					events.addRegionEventListener("mousedown", function(){						
						
						var mousePos = events.getMousePos();
						if( mousePos.x - puzx[i]< piecewidth &&  mousePos.x - puzx[i]>0){
							draggingRect[i] = true;
							draggingRectOffsetX[i] = mousePos.x - puzx[i];
							draggingRectOffsetY[i] = mousePos.y - puzy[i];
						}
					});
					events.addRegionEventListener("mouseup", function(){					
						
						//now check if pieces are organized
						for(i=0;i<9;i++){
							draggingRect[i] = false;
							if(i==2||i==5){
								if((puzx[i]-(piecewidth*2)>puzx[i+1]-pixlet)&&(puzx[i]-(piecewidth*2)<puzx[i+1]+pixlet)){

									if((puzy[i] + piecewidth > puzy[i+1]-pixlet)&&(puzy[i] + piecewidth < puzy[i+1]+pixlet)){
										check++;
									}
								}
							}
							else if (i==8){
								check++;
							}
							else{
								if((puzx[i]+piecewidth>puzx[i+1]-pixlet)&&(puzx[i]+piecewidth<puzx[i+1]+pixlet)){
									if((puzy[i]  > puzy[i+1]-pixlet) && ( puzy[i] < puzy[i+1]+pixlet)){
										check++;
									}
								}
							}
						}
						
						//check if all of the pieces are correct
						if(check == 9){
							//pieces are organized
							message.displayMess("You solved the puzzle :D");
							check = 0;	
							puzzleComplete = true;
							changeScreen(1);
							
						}
						else{
							check = 0;
						}					
					});
					events.addRegionEventListener("mouseout", function () {
						document.body.style.cursor = "default";
					});
					events.addRegionEventListener("mousemove", function () {
						document.body.style.cursor = "pointer";
					});
					events.closeRegion();
					
					
				}
			
			},
			//portrait events
			function(){
				if(safeOpen){
					getItemEvent(0,0,480,700,"openportrait");
					if(!hasBedroomKey){
						getItemEvent(650, 220, 200, 200,"bedroomkey");
					}
				}
				else if(portraitOpen){
					getItemEvent(0,0,480,700,"openportrait");
					getItemEvent(760,445,200,70,"enter");
					//button events
					getItemEvent(560,170,70,70,"0up");
					getItemEvent(660,170,70,70,"1up");
					getItemEvent(760,170,70,70,"2up");
					getItemEvent(860,170,70,70,"3up");
					getItemEvent(560,355,70,70,"0down");
					getItemEvent(660,355,70,70,"1down");
					getItemEvent(760,355,70,70,"2down");
					getItemEvent(860,355,70,70,"3down");
				}
				else{
					createEventBox(0,0,480,700,1);
					//to open portrait
					getItemEvent(490,60,500,550,"openportrait");
					
				}
			},
			//drawer events
			function(){
				if(!drawerOpening){
					if (!drawerOpen) {				
						createEventBox(0,0,100,50,1); // BACK BUTTON
						if (hasDrawerKey) {
							getItemEvent(240, 370, 520, 100, "opendrawer");
						}
					}
					else {
							createEventBox(0,0,100,50,1); // BACK BUTTON
							getItemEvent(110, 600, 780, 95, "opendrawer");
							
						
					}
				}
			
			},
			//xylophone events
			function(){
			
				var mousePos = events.getMousePos();
				stickX = mousePos.x ;
				stickY = mousePos.y ;
				createEventBox(0,0,1000,320,1);				
				
				events.beginRegion();
				events.context.beginPath();
				//events.context.lineWidth = 4;
				//events.context.strokeStyle = "black";
				//events.context.fillStyle = "#00D2FF";
				events.context.rect(0,322,1000,378);
				events.context.closePath();		
				//events.context.fill();
				//events.context.stroke();
				events.addRegionEventListener("mousedown",function(){
					for (var i = 0; i < 7; i++) {
						if (noteRow[i].keyDidPlay(stickX, stickY)) {
							noteRow[i].playSelf();
							currentnote = i;
						}
					}
				});
				events.closeRegion();
				document.body.style.cursor = "none";	//no cursor	
			
			},
			//hallway events
			function(){
				createEventBox(670,40,200,550,7);
				createEventBox(0,0,100,50,0);
				createEventBox(0,450,430,250,1);
			},
			//bedroom events
			function(){
				if(!bedroomOpening&&!bedroomOpening2){
					createEventBox(0,0,100,50,0);
					createEventBox(0,550,1000,150,6);
					if(bedroomOpen){
						//change coordinates to correct door location
						getItemEvent(670, 10, 310, 530,"toggledoor");
					}
					else{						
												
						getItemEvent(345, 10, 310, 530,"toggledoor");
					}
				}
			},
			function(){
			},
			function(){
			},
			function(){
			}
		];
	
	
	}
	
	function game(){
		events = new Events("canvasOne");
		var anim = new Animation("canvasOne");
		var canvas = anim.getCanvas();
		var context = anim.getContext();
		
		
		createScreens(); //create function arrays to handle drawing and events
		
		document.addEventListener("keypress", function(event) {
			toolbox = !toolbox;
		});
		
		events.setStage(function () {
			document.body.style.cursor = "default";
			drawEvents[currentScreen]();			
		});
		
		
		anim.setStage(function() {
			console.log("anim loop");
			
			this.clear();			
			screens[currentScreen]();
			
			if(toolbox && currentScreen != 0){
				//draw toolbox
				events.context.beginPath();
				events.context.rect(0, 0, 100, 400);
				events.context.lineWidth = 4;
				events.context.strokeStyle = "black";
				events.context.fillStyle = "#FFFFFF";
				events.context.fill();
				events.context.stroke();
				events.context.closePath();
				
				events.context.font = "25px Georgia";
				events.context.fillStyle= "black";
				events.context.fillText("ToolBox", 4, 25);
				
				
				if(hasBedroomKey){	
					//using text of key 2 somehow glitches
					events.context.drawImage(images["key2"], 20, 40, 50, 50);
				}
				if(hasWeapon){
					events.context.drawImage(images["poker"], 30, 100, 50, 50);
				}
			}
			
			
			message.drawMessage();
		
		});
		anim.start();
	
	}

    window.onload = function() {
		init();
	}
</script>
</body>
</html>